{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "siteName": {
        "type": "string",
        "metadata": {
          "description": "Name of the Web App."
        }
      },
      "hostingPlanName": {
        "type": "string",
        "metadata": {
          "description": "Name of the App Service Plan."
        }
      },
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "allowedValues": [
          "South Central US",
          "South Africa North",
          "West US",
          "Australia East",
          "Brazil South",
          "Southeast Asia",
          "Central US",
          "Japan West",
          "Central India",
          "UK South",
          "Canada East",
          "Korea Central",
          "France Central",
          "North Europe",
          "West US 2",
          "East US",
          "West India",
          "East US 2",
          "Australia Central",
          "Germany West Central",
          "Norway West",
          "Norway East",
          "UAE North",
          "Sweden Central",
          "Qatar Central",
          "Switzerland North",
          "North Central US",
          "UK West",
          "Australia Southeast",
          "Korea South",
          "Canada Central",
          "West Europe",
          "South India",
          "West Central US",
          "West US 3",
          "East Asia",
          "Japan East",
          "South Africa West",
          "Poland Central",
          "Italy North",
          "Israel Central",
          "Spain Central",
          "Mexico Central",
          "New Zealand North",
          "Indonesia Central"
        ],
        "metadata": {
          "description": "Azure region."
        }
      },
      "openaiKey": {
        "type": "securestring",
        "metadata": {
          "description": "Your OpenAI API key."
        }
      },
      "sku": {
        "type": "object",
        "defaultValue": {
          "name": "B1",
          "tier": "Basic"
        },
        "allowedValues": [
          {
            "name": "F1",
            "tier": "Free"
          },
          {
            "name": "D1",
            "tier": "Shared"
          },
          {
            "name": "B1",
            "tier": "Basic"
          },
          {
            "name": "P1v2",
            "tier": "PremiumV2"
          }
        ],
        "metadata": {
          "description": "Select the SKU for the App Service Plan."
        }
      }
    },
    "resources": [
      {
        "type": "Microsoft.Web/serverfarms",
        "apiVersion": "2022-03-01",
        "name": "[parameters('hostingPlanName')]",
        "location": "[parameters('location')]",
        "sku": "[parameters('sku')]",
        "properties": {}
      },
      {
        "type": "Microsoft.Web/sites",
        "apiVersion": "2022-03-01",
        "name": "[parameters('siteName')]",
        "location": "[parameters('location')]",
        "dependsOn": [
          "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]"
        ],
        "properties": {
          "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]",
          "siteConfig": {
            "appSettings": [
              {
                "name": "OPENAI_API_KEY",
                "value": "[parameters('openaiKey')]"
              }
            ]
          }
        }
      }
    ],
    "outputs": {
      "siteUrl": {
        "type": "string",
        "value": "[concat('https://', parameters('siteName'), '.azurewebsites.net')]"
      }
    }
  }
