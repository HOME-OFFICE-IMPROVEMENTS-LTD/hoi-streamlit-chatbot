
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "siteName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Web App."
      }
    },
    "hostingPlanName": {
      "type": "string",
      "metadata": {
        "description": "Name of the App Service Plan."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "allowedValues": [
        "East US", "East US 2", "West US", "West US 2", "West US 3", "Central US", "South Central US",
        "North Central US", "West Central US", "North Europe", "West Europe", "France Central",
        "Germany West Central", "Norway East", "Norway West", "Sweden Central", "Switzerland North",
        "UK South", "UK West", "Canada Central", "Canada East", "Brazil South", "Mexico Central",
        "South Africa North", "South Africa West", "Qatar Central", "UAE North", "Australia East",
        "Australia Southeast", "Australia Central", "New Zealand North", "Japan East", "Japan West",
        "Korea Central", "Korea South", "India Central", "India South", "India West", "Southeast Asia",
        "East Asia", "Poland Central", "Italy North", "Spain Central", "Israel Central", "Indonesia Central"
      ],
      "metadata": {
        "description": "Azure region."
      }
    },
    "openaiKey": {
      "type": "securestring",
      "metadata": {
        "description": "Your OpenAI API key."
      }
    },
    "sku": {
      "type": "object",
      "defaultValue": {
        "name": "B1",
        "tier": "Basic"
      },
      "allowedValues": [
        { "name": "F1", "tier": "Free" },
        { "name": "D1", "tier": "Shared" },
        { "name": "B1", "tier": "Basic" },
        { "name": "P1v2", "tier": "PremiumV2" }
      ],
      "metadata": {
        "description": "Select the SKU for the App Service Plan."
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.Web/serverfarms",
      "apiVersion": "2022-03-01",
      "name": "[parameters('hostingPlanName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('sku').name]",
        "tier": "[parameters('sku').tier]"
      },
      "properties": {}
    },
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2022-03-01",
      "name": "[parameters('siteName')]",
      "location": "[parameters('location')]",
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]"
      ],
      "properties": {
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('hostingPlanName'))]",
        "siteConfig": {
          "appSettings": [
            {
              "name": "OPENAI_API_KEY",
              "value": "[parameters('openaiKey')]"
            },
            {
              "name": "SCM_DO_BUILD_DURING_DEPLOYMENT",
              "value": "true"
            }
          ]
        },
        "repositorySiteName": "[parameters('siteName')]",
        "repositoryUrl": "https://github.com/HOME-OFFICE-IMPROVEMENTS-LTD/hoi-streamlit-chatbot",
        "branch": "main",
        "isManualIntegration": true,
        "deploymentMethod": "GitHub"
      }
    }
  ],
  "outputs": {
    "siteUrl": {
      "type": "string",
      "value": "[concat('https://', parameters('siteName'), '.azurewebsites.net')]"
    }
  }
}
